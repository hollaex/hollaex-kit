{"version":3,"sources":["../../../../src/lib/utils/ChartDataUtil.js"],"names":["React","extent","set","flattenDeep","Chart","last","isObject","getClosestItem","zipper","isDefined","isNotDefined","functor","mapObject","find","shallowEqual","getChartOrigin","origin","contextWidth","contextHeight","originCoordinates","getDimensions","chartProps","width","height","chartHeight","availableHeight","values","func","d","obj","isArraySize2AndNumber","yExtentsProp","Array","isArray","length","a","b","getNewChartConfig","innerDimension","children","existingChartConfig","Children","map","each","type","toString","defaultProps","props","id","padding","yExtents","yScaleProp","yScale","flipYScale","yExtentsCalculator","copy","yPan","yPanEnabled","undefined","prevChartConfig","originalYExtentsProp","domain","filter","getCurrentCharts","chartConfig","mouseXY","currentCharts","top","eachConfig","bottom","config","setRange","scale","rangeRoundPoints","invert","isNaN","Error","rangeRound","range","yDomainFromYExtents","plotData","yValues","eachExtent","allYValues","realYDomain","getChartConfigWithUpdatedYScales","xDomain","dy","chartsToPan","xAccessor","displayXAccessor","fullData","yDomains","yDomainDY","prevYDomain","combine","another","indexOf","newYScale","updatedChartConfig","getCurrentItem","xScale","xValue","item","idx","x","Math","abs","reduce","getXValue","value","round"],"mappings":"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","file":"ChartDataUtil.js","sourcesContent":["\n\nimport React from \"react\";\nimport { extent } from \"d3-array\";\nimport { set } from \"d3-collection\";\nimport flattenDeep from \"lodash.flattendeep\";\n\nimport Chart from \"../Chart\";\n\nimport {\n\tlast,\n\tisObject,\n\tgetClosestItem,\n\tzipper,\n\tisDefined,\n\tisNotDefined,\n\tfunctor,\n\tmapObject,\n\tfind,\n\tshallowEqual\n} from \"./index\";\n\nexport function getChartOrigin(origin, contextWidth, contextHeight) {\n\tconst originCoordinates = typeof origin === \"function\"\n\t\t? origin(contextWidth, contextHeight)\n\t\t: origin;\n\treturn originCoordinates;\n}\n\nexport function getDimensions({ width, height }, chartProps) {\n\n\tconst chartHeight = (chartProps.height || height);\n\n\treturn {\n\t\tavailableHeight: height,\n\t\twidth,\n\t\theight: chartHeight\n\t};\n}\n\nfunction values(func) {\n\treturn (d) => {\n\t\tconst obj = func(d);\n\t\tif (isObject(obj)) {\n\t\t\treturn mapObject(obj);\n\t\t}\n\t\treturn obj;\n\t};\n}\n\nfunction isArraySize2AndNumber(yExtentsProp) {\n\tif (Array.isArray(yExtentsProp) && yExtentsProp.length === 2) {\n\t\tconst [a, b] = yExtentsProp;\n\t\treturn (typeof a == \"number\" && typeof b == \"number\");\n\t}\n\treturn false;\n}\n\nexport function getNewChartConfig(innerDimension, children, existingChartConfig = []) {\n\treturn React.Children.map(children, (each) => {\n\t\tif (each && each.type.toString() === Chart.toString()) {\n\t\t\tconst chartProps = {\n\t\t\t\t...Chart.defaultProps,\n\t\t\t\t...each.props\n\t\t\t};\n\t\t\tconst {\n\t\t\t\tid,\n\t\t\t\torigin,\n\t\t\t\tpadding,\n\t\t\t\tyExtents: yExtentsProp,\n\t\t\t\tyScale: yScaleProp,\n\t\t\t\tflipYScale,\n\t\t\t\tyExtentsCalculator\n\t\t\t} = chartProps;\n\n\t\t\tconst yScale = yScaleProp.copy();\n\t\t\tconst {\n\t\t\t\twidth, height, availableHeight\n\t\t\t} = getDimensions(innerDimension, chartProps);\n\n\t\t\tconst { yPan } = chartProps;\n\t\t\tlet { yPanEnabled } = chartProps;\n\t\t\t// var { yMousePointerRectWidth: rectWidth, yMousePointerRectHeight: rectHeight, yMousePointerArrowWidth: arrowWidth } = each.props;\n\t\t\t// var mouseCoordinates = { at, yDisplayFormat, rectHeight, rectWidth, arrowWidth };\n\t\t\tconst yExtents = isDefined(yExtentsProp)\n\t\t\t\t? (Array.isArray(yExtentsProp) ? yExtentsProp : [yExtentsProp]).map(functor)\n\t\t\t\t: undefined;\n\n\t\t\tconst prevChartConfig = find(existingChartConfig, d => d.id === id);\n\n\t\t\tif (isArraySize2AndNumber(yExtentsProp)) {\n\t\t\t\tif (\n\t\t\t\t\tisDefined(prevChartConfig)\n\t\t\t\t\t&& prevChartConfig.yPan\n\t\t\t\t\t&& prevChartConfig.yPanEnabled\n\t\t\t\t\t&& yPan\n\t\t\t\t\t&& yPanEnabled\n\t\t\t\t\t&& shallowEqual(prevChartConfig.originalYExtentsProp, yExtentsProp)\n\t\t\t\t) {\n\t\t\t\t\t// console.log(prevChartConfig.originalYExtentsProp, yExtentsProp)\n\t\t\t\t\t// console.log(prevChartConfig.yScale.domain())\n\t\t\t\t\tyScale.domain(prevChartConfig.yScale.domain());\n\t\t\t\t} else {\n\t\t\t\t\tconst [a, b] = yExtentsProp;\n\t\t\t\t\tyScale.domain([a, b]);\n\t\t\t\t}\n\t\t\t} else if (isDefined(prevChartConfig) && prevChartConfig.yPanEnabled) {\n\t\t\t\tif (isArraySize2AndNumber(prevChartConfig.originalYExtentsProp)) {\n\t\t\t\t\t// do nothing\n\t\t\t\t} else {\n\t\t\t\t\tyScale.domain(prevChartConfig.yScale.domain());\n\t\t\t\t\tyPanEnabled = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid,\n\t\t\t\torigin: functor(origin)(width, availableHeight),\n\t\t\t\tpadding,\n\t\t\t\toriginalYExtentsProp: yExtentsProp,\n\t\t\t\tyExtents,\n\t\t\t\tyExtentsCalculator,\n\t\t\t\tflipYScale,\n\t\t\t\t// yScale: setRange(yScale.copy(), height, padding, flipYScale),\n\t\t\t\tyScale: yScale,\n\t\t\t\tyPan,\n\t\t\t\tyPanEnabled,\n\t\t\t\t// mouseCoordinates,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t};\n\t\t}\n\t\treturn undefined;\n\t}).filter(each => isDefined(each));\n}\nexport function getCurrentCharts(chartConfig, mouseXY) {\n\tconst currentCharts = chartConfig.filter(eachConfig => {\n\t\tconst top = eachConfig.origin[1];\n\t\tconst bottom = top + eachConfig.height;\n\t\treturn (mouseXY[1] > top && mouseXY[1] < bottom);\n\t}).map(config => config.id);\n\n\treturn currentCharts;\n}\n\nfunction setRange(scale, height, padding, flipYScale) {\n\tif (scale.rangeRoundPoints || isNotDefined(scale.invert)) {\n\t\tif (isNaN(padding)) throw new Error(\"padding has to be a number for ordinal scale\");\n\t\tif (scale.rangeRoundPoints) scale.rangeRoundPoints(flipYScale ? [0, height] : [height, 0], padding);\n\t\tif (scale.rangeRound) scale.range(flipYScale ? [0, height] : [height, 0]).padding(padding);\n\t} else {\n\t\tconst { top, bottom } = isNaN(padding)\n\t\t\t? padding\n\t\t\t: { top: padding, bottom: padding };\n\n\t\tscale.range(flipYScale ? [top, height - bottom] : [height - bottom, top]);\n\t}\n\treturn scale;\n}\n\nfunction yDomainFromYExtents(yExtents, yScale, plotData) {\n\tconst yValues = yExtents.map(eachExtent =>\n\t\tplotData.map(values(eachExtent)));\n\n\tconst allYValues = flattenDeep(yValues);\n\t// console.log(allYValues)\n\tconst realYDomain = (yScale.invert)\n\t\t? extent(allYValues)\n\t\t: set(allYValues).values();\n\n\treturn realYDomain;\n}\n\n\nexport function getChartConfigWithUpdatedYScales(\n\tchartConfig,\n\t{ plotData, xAccessor, displayXAccessor, fullData },\n\txDomain,\n\tdy,\n\tchartsToPan\n) {\n\tconst yDomains = chartConfig\n\t\t.map(({ yExtentsCalculator, yExtents, yScale }) => {\n\n\t\t\tconst realYDomain = isDefined(yExtentsCalculator)\n\t\t\t\t? yExtentsCalculator({ plotData, xDomain, xAccessor, displayXAccessor, fullData })\n\t\t\t\t: yDomainFromYExtents(yExtents, yScale, plotData);\n\n\t\t\t// console.log(\"yScale.domain() ->\", yScale.domain())\n\n\t\t\tconst yDomainDY = isDefined(dy)\n\t\t\t\t? yScale.range().map(each => each - dy).map(yScale.invert)\n\t\t\t\t: yScale.domain();\n\t\t\treturn {\n\t\t\t\trealYDomain,\n\t\t\t\tyDomainDY,\n\t\t\t\tprevYDomain: yScale.domain(),\n\t\t\t};\n\t\t});\n\n\tconst combine = zipper()\n\t\t.combine((config, { realYDomain, yDomainDY, prevYDomain }) => {\n\t\t\tconst { id, padding, height, yScale, yPan, flipYScale, yPanEnabled = false } = config;\n\n\t\t\tconst another = isDefined(chartsToPan)\n\t\t\t\t? chartsToPan.indexOf(id) > -1\n\t\t\t\t: true;\n\t\t\tconst domain = yPan && yPanEnabled\n\t\t\t\t? another ? yDomainDY : prevYDomain\n\t\t\t\t: realYDomain;\n\n\t\t\t// console.log(id, yPan, yPanEnabled, another);\n\t\t\t// console.log(domain, realYDomain, prevYDomain);\n\t\t\tconst newYScale = setRange(\n\t\t\t\tyScale.copy().domain(domain), height, padding, flipYScale\n\t\t\t);\n\t\t\treturn {\n\t\t\t\t...config,\n\t\t\t\tyScale: newYScale,\n\t\t\t\trealYDomain: realYDomain,\n\t\t\t};\n\t\t\t// return { ...config, yScale: yScale.copy().domain(domain).range([height - padding, padding]) };\n\t\t});\n\n\tconst updatedChartConfig = combine(chartConfig, yDomains);\n\t// console.error(yDomains, dy, chartsToPan, updatedChartConfig.map(d => d.yScale.domain()));\n\t// console.log(updatedChartConfig.map(d => ({ id: d.id, domain: d.yScale.domain() })))\n\n\treturn updatedChartConfig;\n}\n\nexport function getCurrentItem(xScale, xAccessor, mouseXY, plotData) {\n\tlet xValue, item;\n\tif (xScale.invert) {\n\t\txValue = xScale.invert(mouseXY[0]);\n\t\titem = getClosestItem(plotData, xValue, xAccessor);\n\t} else {\n\t\tconst d = xScale.range().map((d, idx) => ({ x: Math.abs(d - mouseXY[0]), idx })).reduce((a, b) => a.x < b.x ? a : b);\n\t\titem = isDefined(d) ? plotData[d.idx] : plotData[0];\n\t\t// console.log(d, item);\n\t}\n\treturn item;\n}\n\nexport function getXValue(xScale, xAccessor, mouseXY, plotData) {\n\n\tlet xValue, item;\n\tif (xScale.invert) {\n\t\txValue = xScale.invert(mouseXY[0]);\n\t\tif (xValue > xAccessor(last(plotData)) && xScale.value) {\n\t\t\treturn Math.round(xValue);\n\t\t} else {\n\t\t\titem = getClosestItem(plotData, xValue, xAccessor);\n\t\t}\n\t} else {\n\t\tconst d = xScale.range().map((d, idx) => ({ x: Math.abs(d - mouseXY[0]), idx })).reduce((a, b) => a.x < b.x ? a : b);\n\t\titem = isDefined(d) ? plotData[d.idx] : plotData[0];\n\t\t// console.log(d, item);\n\t}\n\treturn xAccessor(item);\n}\n"]}